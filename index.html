<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Epersgeist</title>
    <link rel="stylesheet" href="css/rankings.css">
    <link rel="icon" href="./img/icon.png" type="image/x-icon"/>
</head>

<body>
    <nav>
        <div class="navbar-content">
            <span class="navbar-title">Ranking Epersgeist</span>
            <button class="btn-a" id="open-espiritu-btn">Crear Esp√≠ritu</button>
            <button class="btn-a" id="random-espiritu-btn">Generar Esp√≠ritu Aleatorio</button>
        </div>
    </nav>
    <br><br><br>
    <div class="divisor">
        <h1> TOP ESPIRITUAL </h1>
    </div>
    <div class="ranking-container">
        <div class="ranking-box" id="ranking-ganadas">
            <h2>Batallas Ganadas</h2>
            <table class="ranking-table" id="ranking-ganadas-table">
                <thead>
                    <tr>
                        <th>Posici√≥n</th>
                        <th>Nombre</th>
                        <th>Ganadas</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aqu√≠ se insertar√°n las filas din√°micamente -->
                </tbody>
            </table>
        </div>
        <div class="ranking-box" id="ranking-perdidas">
            <h2>Batallas Perdidas</h2>
            <table class="ranking-table" id="ranking-perdidas-table">
                <thead>
                    <tr>
                        <th>Posici√≥n</th>
                        <th>Nombre</th>
                        <th>Perdidas</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aqu√≠ se insertar√°n las filas din√°micamente -->
                </tbody>
            </table>
        </div>
        <div class="ranking-box" id="ranking-jugadas">
            <h2>Batallas jugadas</h2>
            <table class="ranking-table" id="ranking-jugadas-table">
                <thead>
                    <tr>
                        <th>Posici√≥n</th>
                        <th>Nombre</th>
                        <th>Jugadas</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aqu√≠ se insertar√°n las filas din√°micamente -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="divisor">
        <h1> PANEL PRINCIPAL </h1>
    </div>
    <div class="all-container">
        <!-- Nueva tabla: Todos los esp√≠ritus con todos sus atributos -->
        <div class="general-box" id="ranking-todos">
            <h2>Todos los esp√≠ritus</h2>
            <table class="ranking-table" id="ranking-todos-table">
                <thead>
                    <tr>
                        <th>üë§ Nombre</th>
                        <th>‚ù§Ô∏è Vida</th>
                        <th>ü™Ω Clasificaci√≥n </th>
                        <th>‚öîÔ∏è Ataque</th>
                        <th>üõ°Ô∏è Defensa</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="user-spirit-data">
            <h2 id="card-title">Datos del Esp√≠ritu</h2>
            <div id="user-spirit-info">
                <p><strong>Nombre:</strong> <span id="user-spirit-name"></span></p>
                <p><strong>Vida:</strong> <span id="user-spirit-vida"></span></p>
                <p><strong>Ataque:</strong> <span id="user-spirit-attack"></span></p>
                <p><strong>Defensa:</strong> <span id="user-spirit-defense"></span></p>
                <p><strong>Tipo:</strong> <span id="user-spirit-type"></span></p>
            </div>
        </div>
    </div>
    <dialog id="espiritu-dialog">
        <div class="modal-header">Crear Esp√≠ritu</div>
        <form id="espiritu-form" method="dialog">
            <label>Nombre<br />
                <input type="text" name="nombre" required />
            </label>
            <label>Tipo<br />
                <select name="tipo" required>
                    <option value="ANGELICAL">ANGELICAL</option>
                    <option value="DEMONIACO">DEMONIACO</option>
                </select>
            </label>
            <label style="display: none;">UBICACION ID<br />
                <input type="number" value="1" name="ubicacionId" min="1" required />
            </label>
            <label>Ataque<br />
                <input type="number" name="ataque" min="1" required />
            </label>
            <label>Defensa<br />
                <input type="number" name="defensa" min="1" required />
            </label>
            <menu class="modal-footer">
                <button type="submit">Guardar</button>
            </menu>
        </form>
    </dialog>
    <script type="module" src="./js/main.js"></script>
    <script type="module">
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
        import { app } from './js/firebaseConfig.js';

        const loginBtn = document.getElementById('login-btn');
        loginBtn.addEventListener('click', async () => {
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                alert('Sesi√≥n iniciada correctamente');
            } catch (error) {
                alert('Error al iniciar sesi√≥n: ' + error.message);
            }
        });

        // Abrir el modal de creaci√≥n de esp√≠ritu solo cuando se hace click en el bot√≥n
        const openEspirituBtn = document.getElementById('open-espiritu-btn');
        const espirituDialog = document.getElementById('espiritu-dialog');
        openEspirituBtn.addEventListener('click', () => {
            espirituDialog.showModal();
        });

        // L√≥gica para el bot√≥n aleatorio
        document.getElementById('random-espiritu-btn').addEventListener('click', async () => {
            // Generar valores aleatorios
            const nombres = ["Ariel", "Belial", "Uriel", "Lilith", "Gabriel", "Azazel"];
            const tipos = ["ANGELICAL", "DEMONIACO"];
            const nombre = nombres[Math.floor(Math.random() * nombres.length)];
            const tipo = tipos[Math.floor(Math.random() * tipos.length)];
            const ataque = Math.floor(Math.random() * 100) + 1;
            const defensa = Math.floor(Math.random() * 100) + 1;
            const data = {
                nombre,
                tipo,
                ubicacionId: 1,
                coordenada: { latitud: -34.603733, longitud: -58.382033 },
                ataque,
                defensa
            };
            try {
                const response = await fetch("http://localhost:8080/espiritu", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data),
                });
                if (!response.ok) {
                    const errBody = await response.json().catch(() => null);
                    const msg = errBody?.message || `Error al guardar (status ${response.status})`;
                    alert(msg);
                    return;
                }
                const creado = await response.json();
                alert("Esp√≠ritu aleatorio creado correctamente: " + creado.nombre);
            } catch (err) {
                alert("Fall√≥ al crear el esp√≠ritu aleatorio: " + err.message);
            }
        });
    </script>
</body>

</html>